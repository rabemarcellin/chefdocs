
### Content-Type: text/event-stream

On va maintenant cr√©er une endpoint api de type SSE

Il faut d√©finir les headers de l'endpoint SSE comme suit:
- **Content-Type: text/event-stream**: D√©finir que c'est un api de type Server-Sent Events (SSE),
c'est-√†-dire que cette api va envoyer des r√©ponses(√©v√©nements) en temps r√©el.
- **Connection: keep-alive**: Le flux de connexion reste ouvert.

et aussi
- **Cache-Control: no-cache**

<hr/>
<div style={{textAlign: "center"}}>**Exemple d'endpoint de type SSE avec Node.js**</div>
<br/>

```tsx
import express from "express";

const app = express();

app.get("/stream", (req, res) => {
  res.setHeader("Content-Type", "text/event-stream");
  res.setHeader("Cache-Control", "no-cache");
  res.setHeader("Connection", "keep-alive");


  res.write(`event: start\n`);
  res.write(`data: ${JSON.stringify({ message: "Je suis un r√©ponse en temps r√©el" })}\n\n`);
  

  req.on("close", () => {
    // fait quelque chose ici si tu le veux une fois la connexion ferm√©e
  });
});
```

<hr/>
<div style={{textAlign: "center"}}>**Exemple d'endpoint de type SSE avec FastAPI**</div>
<br/>

```python
from fastapi import FastAPI
from fastapi.responses import StreamingResponse
import asyncio
import json

app = FastAPI()

async def event_stream():
    yield f"event: start\n"
    yield f"data: {json.dumps({'message': 'Je suis une r√©ponse en temps r√©el'})}\n\n"


@app.get("/stream")
async def stream():
    return StreamingResponse(event_stream(), media_type="text/event-stream")
```

<div class="note">
Les r√©ponses de type:

`event: qlq chose` 

`data: qlq chose`

 Si √ßa te dis quelque chose, c'est du SSE xD‚Äã

 Et oui! üòÅ
 </div>


Les sp√©cifications du SSE sont que:
- les r√©ponses soient toujours du texte `string`
- on n'envoie pas les r√©ponses par `res.json()` ou `res.send()` par exemple, sinon √ßa va fermer le flux de connexion.
on utilise plut√¥t `res.write()` en javascript, ou `yield` en python.
- tu peux intercepter le moment o√π la connexion est ferm√©e, par exemple pour faire quelque chose par exemple. 
Mais je pense, pas que la fermeture de la connexion seulement. Mais tu peux faire un truc de ce genre,
je veux dire.

<hr/>

On peut maintenant appeler cette endpoint dans le frontend, elle va r√©pondre maintenant en temps r√©el.
donner les r√©ponses petit √† petit dans les formats `data: qlq chose`. Chose qu'on va savoir comment le 
r√©cuperer dans le front-end maintenant.